---
title: "Electricity generation by countries"
author:
  - name: "Eric Bidong Wakunga"
    orcid: "0009-0001-3770-5405"
    email: "eric.bidongsr@colorado.edu"
    affiliation:
      - name: "University of Colorado Boulder"
        department: "Department of Civil, Environmental and Architectural Engineering"
        city: "Boulder"
        state: "CO"
        country: "USA"
date: today
format: html
execute: 
  warning: false
editor: visual
editor_options: 
  chunk_output_type: console
---

# Introduction

This is the global electricity generation dataset by countries over 10 to 30 years. We will use this for the capstone project to look the total production the last 10 years from the recent year in the dataset and the average production growth rate by countries.

# Methods

## **Loading libraries**

```{r}
#import libraries

library(tidyverse)
library(here)
library(dplyr)
```

## Reading data

```{r}
energy_generation_by_countries <- read_csv(here("data/raw/capston_dataset.csv"))
```

## Data Exploratory Approach

### Data summary

```{r}
dim(energy_generation_by_countries)
```

This dataset has 7653 rows and 4 columns.

Let's visualize the first five rows to inspect the data.

```{r}

head(energy_generation_by_countries)
```

The data looks good. There are some countries that are missing Code, but this is not important since we have the names of these countries.

The data types are also correct.

Let's group data by country and summarize the statistics for exploration.

```{r}

energy_summary <- energy_generation_by_countries |>
  group_by(Entity) |>
  summarise(
    total_generation_TWh = sum(`Electricity generation - TWh`, na.rm = TRUE),
    n_years = n()
  ) |>
  arrange(desc(total_generation_TWh))

energy_summary
```

As you can see, there are aggregated data by region (OECD, High-income countries, etc) that are included in this dataset. In the next section, we will remove those in order to stick with only countries.

Let's now see the electricity generation growth rate by countries

```{r}
growth_rates <- energy_generation_by_countries |>
  arrange(Entity, Year) |>
  group_by(Entity) |>
  mutate(
    prev_year_generation = lag(`Electricity generation - TWh`),
    annual_growth_rate = (`Electricity generation - TWh` - prev_year_generation) / prev_year_generation
  ) |>
  summarise(
    total_generation_TWh = sum(`Electricity generation - TWh`, na.rm = TRUE),
    avg_annual_growth = mean(annual_growth_rate, na.rm = TRUE),
    min_year = min(Year),
    max_year = max(Year),
    n_years = n() - 1
  ) |>
  arrange(desc(avg_annual_growth))

growth_rates
```

Energy generation growth rate is high in developing countries. This shows that much effort is put recently to increase the generation capacity. We could interestingly compare such data with GDP data or any other wealth metric to understand better what is going on in each country.

## **Initial data Tidying**

### Removing aggregated data by region

As shown previously, our dataset includes aggregated data which can bias our analysis. So we have to remove them.

```{r}
entity_to_remove <- c(
  "World", "G20 (Ember)", "High-income countries", "OECD (EI)", "Non-OECD (EI)", "Asia", "OECD (Ember)", "Asia Pacific (EI)", "Upper-middle-income countries", "Asia (Ember)", 
"G7 (Ember)", "North America (EI)", "North America", "Europe", "Europe (EI)", "Europe (Ember)", "North America (Ember)", "European Union (27)","EU (Ember)","Lower-middle-income countries","CIS (EI)", "South and Central America (EI)", "Latin America and Caribbean (Ember)","South America", "Middle East (EI)", "Middle East (Ember)", "Africa", "Africa (EI)", "ASEAN (Ember)", "Africa (Ember)", "Oceania", "Oceania (Ember)", "Eastern Africa (EI)","Western Africa (EI)", "Central America (EI)", "Middle Africa (EI)"
)

energy_generation_by_countries <- energy_generation_by_countries |>
  filter(!Entity %in% entity_to_remove)
```

Now the aggregates have been remove, let's recompile the energy_summary by countries and update the dataframe.

```{r}
energy_summary <-energy_generation_by_countries |>
  arrange(Entity, Year) |>
  group_by(Entity) |>
  mutate(
    prev_year_generation = lag(`Electricity generation - TWh`),
    annual_growth_rate = (`Electricity generation - TWh` - prev_year_generation) / prev_year_generation
  ) |>
  summarise(
    total_generation_TWh = sum(`Electricity generation - TWh`, na.rm = TRUE),
    avg_annual_growth = mean(annual_growth_rate, na.rm = TRUE),
    min_year = min(Year),
    max_year = max(Year),
    n_years = n() - 1
  ) |>
  arrange(desc(total_generation_TWh))

energy_summary
```

### Renaming columns

Let lower the names of the columns and remove all the spaces

```{r}
energy_generation_by_countries <- energy_generation_by_countries |>
  rename_with(~ str_to_lower(.)) |>
  rename_with(~ str_replace_all(., "[\\s\\-]+", "_")) |>
  rename_with(~ str_replace_all(., "[^a-z0-9_]", ""))

energy_generation_by_countries
```

### Saving data

```{r}
write_csv(energy_generation_by_countries, here("data/processed/energy_production.csv"))
```

# Results

# Conclusions

## Summary of Findings

### Questions and Next Steps
